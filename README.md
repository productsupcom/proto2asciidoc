# proto2asciidoc

## About

proto2asciidoc generates asciidoc documentation from a Protobuffer definition
file. The goal of the project was to prevent API documentation inconsistenties
between the actual API and the docs.

By generating the code from the Protobuf definition the documentation is always
in sync.

It can either generate only the Protobuffer Messages/Enums as output or full
api-docs output depending on the flags passed.

Can be used in conjunction with [code2asciidoc](https://github.com/productsupcom/code2asciidoc)
to produce even more consistent API documentation.

## Variables

When using `api-docs` output, the tool will include a few variables. These can be
set through asciidoctor variables.

Example how to do it in a Makefile

**Makefile.**

``` Makefile
# Variables for the output
PROJECT_NAME := proto2asciidoc
PROJECT_NAME_STYLISHED := ${PROJECT_NAME}
PROJECT_AUTHOR := Productsup GmbH
PROJECT_REPO := https://github.com/productsupcom/proto2asciidoc
GIT_VERSION_NAME := $(shell git describe --tags --exact-match 2> /dev/null || git symbolic-ref -q HEAD || git rev-parse HEAD)
```

## Extension

This tool assumes the extension in `asciidoc/extension` will be loaded when using
AsciiDoctor.

The following snippet can be used inside a Makefile.

<div class="note">

Of course you have to ensure that the directory is in a location your
Makefile can find it.

</div>

**Makefile.**

``` Makefile
# Asciidoctor settings
ASCIIDOC_EXT := -r ./asciidoctor/extensions/proto2asciidoc-inline-macro.rb
ASCIIDOC_ATTRIBUTES := ${ASCIIDOC_EXT} -a project-name=${PROJECT_NAME_STYLISHED} -a project-author="${PROJECT_AUTHOR}" -a project-repo=${PROJECT_REPO} -a version=${GIT_VERSION_NAME}

# Example make for producing HTML
html: docs
    @rm -rf html
    @mkdir html
    @asciidoctor ${ASCIIDOC_ATTRIBUTES} docs/generated/api.adoc -o html/api.html
```

The following shows how the README (if on Github) youâ€™re currently reading
has been produced.

**Optional formats.**

    markdown:
        @asciidoctor ${ASCIIDOC_ATTRIBUTES} docs/readme.adoc -b docbook -a leveloffset=+1 -o - | pandoc  --atx-headers --wrap=preserve -t gfm -f docbook - > README.md

## Example

Please checkout the `docs/` directory for examples how to structure your docs
to use this tool.
Inside `docs/generated/api.adoc` you can find a `--api-docs` output generated by
this tool.
The file `docs/generated/message_enums_only.adoc` is the output when the previous
mentioned flag is not passed.

To generate the docs you can run the following yourself:

**Generate full api-docs.**

``` shell
./proto2asciidoc --source $(pwd)/examples/examples.proto --out docs/generated/api.adoc --overwrite --api-docs
```

The following is useful for imported Protobuf declaration (e.g. from Google).
Note imported messages might not appear as clean as you would hope, so you might
have to edit them by hand before commiting them to your repository.

**Generate messages/enums only.**

``` shell
./proto2asciidoc --source $(pwd)examples/examples.proto --out docs/generated/message_enums_only.adoc --overwrite
```

## Installation

``` shell
go get github.com/productsupcom/proto2asciidoc/cmd/proto2asciidoc
```

## Usage

**--source string**
Source file to parse into AsciiDoc, recommended is to set the absolute path.

**--out**
File to write to, if left empty writes to stdout

**--overwrite, -f**
Overwrite the existing out file

**--no-header**
Do not set a document header and ToC

**--api-dir**
Relative path from the out to the api dir. E.g. docs/generated/api.adoc is the out,
the api dir is docs/api/
then set --api-dir ../api

This path will be used to set the includes for asciidoc

**--api-docs**
Generate a full API documentation, including files from the out file relative dir
../api/SERVICE/endpoint.adoc.

This will include every file in the appropriate location, so e.g. if you have declared Service Foo with endpoint
Do() then it will check for these two files:

/docs/api/foo.adoc
/docs/api/foo/do.adoc

Other files it will check for are:

/docs/about.adoc
/docs/examples.adoc
/docs/api/errors.adoc

Do not set if you only want Messages and/or Enums
